<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>AutoMLReportGen — {{ run.name }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:18px;color:#222;line-height:1.4}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{margin:0}
    .muted{color:#666;font-size:0.95em}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
    .card{background:#fff;border:1px solid #eee;padding:12px;border-radius:8px;box-shadow:0 1px 2px rgba(0,0,0,0.03)}
    .metrics{display:flex;gap:8px;flex-wrap:wrap}
    .metric{padding:8px;border-radius:8px;background:#f6f9ff;border:1px solid #e6f0ff}
    table{border-collapse:collapse;width:100%}
    th,td{border:1px solid #eee;padding:8px;text-align:left}
    img.figure{max-width:100%;height:auto;border-radius:6px;border:1px solid #f0f0f0}
    pre{background:#f7f7f7;padding:8px;border-radius:6px;overflow:auto}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Отчёт: {{ run.name }}</h1>
      <div class="muted">Сформировано: {{ now }}</div>
    </div>
    <div class="muted">Длительность: {{ run.duration_s }} c</div>
  </header>

  <section>
    <h2>Executive summary</h2>
    <div class="card">
      <ul>
        <li>Моделей: {{ run.meta.models|length if run.meta.models else 0 }}</li>
        <li>Артефактов: {{ run.artifacts|length }}</li>
        <li>Ключевые метрики показаны в разделе <b>Модели</b></li>
      </ul>
    </div>
  </section>

  <section>
    <h2>Модели</h2>
    {% if run.meta.models %}
      <div class="grid">
        {% for name, m in run.meta.models.items() %}
          <div class="card">
            <h3>{{ name }} <span class="muted">({{ m.type }})</span></h3>
            <div class="muted">Параметры:</div>
            <pre>{{ m.params }}</pre>
            <div class="muted">Метрики:</div>
            <div class="metrics">
              {% for k, metric in run.metrics.items() %}
                {% if k.startswith(name + '/') %}
                  <div class="metric"><b>{{ k.split('/')[-1] }}</b><br>{{ metric.value|float }}</div>
                {% endif %}
              {% endfor %}
            </div>
            <div style="margin-top:8px">
              <div class="muted">Графики:</div>
              {% for a in run.artifacts %}
                {% if a.name.startswith('figure_') %}
                  <div style="margin-top:6px">
                    <img class="figure" src="{{ a.path }}" alt="{{ a.name }}"/>
                    <div class="muted">{{ a.name }}</div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="card muted">Не обнаружено моделей в namespace. Для автоматического обнаружения положите объекты моделей (например sklearn estimators) в переменные, либо явно передайте y_true_* и y_pred_*.</div>
    {% endif %}
  </section>

  <section>
    <h2>Сравнение метрик (все)</h2>
    <div class="card">
      {% if run.metrics %}
        <table>
          <thead><tr><th>Ключ</th><th>Значение</th></tr></thead>
          <tbody>
            {% for k, m in run.metrics.items() %}
              <tr><td>{{ k }}</td><td>{{ m.value }}</td></tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="muted">Метрики отсутствуют</div>
      {% endif %}
    </div>
  </section>

  <section>
    <h2>Логи и код</h2>
    <div class="grid">
      <div class="card">
        <div class="muted">stdout</div>
        <pre>{{ run.stdout }}</pre>
      </div>
      <div class="card">
        <div class="muted">stderr / error</div>
        {% if run.error %}
          <div style="color:#a00">{{ run.error }}</div>
        {% else %}
          <pre>{{ run.stderr }}</pre>
        {% endif %}
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="muted">Код (объединённый):</div>
      <pre>{{ run.code }}</pre>
    </div>
  </section>
</body>
</html>